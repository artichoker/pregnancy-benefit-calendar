<!DOCTYPE html>
<html>

<head>
    <title>産前産後休務カレンダー</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>

<body>
    <div id="app">
        <v-app>
            <v-main>
                <v-container>
                    <v-sheet>
                        <v-card>
                            <v-card-title>産前休務、産後休務をカレンダー表示します。 出産予定日(出産日)を入力して「OK」をクリックしてください。</v-card-title>
                            <v-card-text>
                                <v-row>
                                    <v-col cols="10">
                                        <v-radio-group v-model="pregnancy" row @change="getCalendar()">
                                            <v-radio label="単胎妊娠" value="single"></v-radio>
                                            <v-radio label="多胎妊娠" value="multiple"></v-radio>
                                        </v-radio-group>
                                    </v-col>
                                </v-row>
                                <v-row v-if="months.length > 0">
                                    <v-col>
                                        <v-row>
                                            <v-col>
                                                <v-chip>予定日</v-chip>{{expectedDate}}
                                                <v-chip>出産日</v-chip>{{birthDate}}</v-col>
                                        </v-row>
                                        <v-row v-if="preStartDate">
                                            <v-col>
                                                <v-chip>産前</v-chip> {{preStartDate.format('yyyy年MM月DD日')}} ～ {{preEndDate.format('yyyy年MM月DD日')}}</v-col>
                                        </v-row>
                                        <v-row v-if="postStartDate">
                                            <v-col>
                                                <v-chip>産後</v-chip> {{postStartDate.format('yyyy年MM月DD日')}} ～ {{ postEndDate.format('yyyy年MM月DD日')}}</v-col>
                                        </v-row>
                                    </v-col>
                                </v-row>
                                <v-row>
                                    <v-col v-for="m in months" :key="m.key" cols="3">
                                        <v-date-picker ref="calendar" :day-format="dayFormat" locale="ja-jp" v-model="dates" :picker-date="m.value" multiple no-title :show-current="false" @input="saveDates"></v-date-picker>
                                    </v-col>
                                </v-row>
                            </v-card-text>
                        </v-card>
                    </v-sheet>
                </v-container>
            </v-main>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js" type="text/javascript"></script>
    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data: () => ({
                pregnancy: 'single',
                expectedDate: moment().format('yyyy-MM-DD'),
                birthDate: moment().format('yyyy-MM-DD'),
                onSchedule: true,
                menu: false,
                menu2: false,
                months: [],
                events: [],
                dates: [],
                preStartDate: null,
                preEndDate: null,
                postStartDate: null,
                postEndDate: null,
            }),
            mounted() {
                const dateStart = moment();
                dateStart.set('date', 1);
                for (let i = 0; i < 6; i++) {
                    this.months.push({
                        key: dateStart.format('M'),
                        value: dateStart.format('yyyy-MM-DD'),
                        label: dateStart.format('yyyy年M月')
                    });
                    dateStart.add(1, 'month')
                }
            },
            methods: {
                saveDates() {
                    if (this.dates.length > 2) {
                        this.dates[1] = this.dates[2];
                        this.dates.length = 2;
                    }
                    switch (this.dates.length) {
                        case 0:
                            break;
                        case 1:
                            this.expectedDate = this.dates[0];
                            this.birthDate = this.dates[0];
                            this.onSchedule = true;
                            this.getCalendar();
                            break;
                        case 2:
                            this.expectedDate = this.dates[0];
                            this.birthDate = this.dates[1];
                            this.onSchedule = false;
                            this.getCalendar();
                            break;
                    }
                },
                getCalendar() {
                    const weeks = this.pregnancy === 'single' ? 6 : 14;
                    const days = (weeks * 7 - 1);
                    this.preStartDate = moment(this.expectedDate).subtract(days, 'days');
                    this.preEndDate = moment(this.birthDate);
                    this.postStartDate = moment(this.birthDate).add(1, 'days');
                    this.postEndDate = moment(this.birthDate).add({
                        weeks: 8
                    })
                    this.months = this.getMonths();
                    this.events = this.getEvents();
                },
                getMonths() {
                    const months = [];
                    const dateStart = moment(this.preStartDate);
                    const dateEnd = moment(this.postEndDate);
                    dateStart.set('date', 1);
                    dateEnd.set('date', 1);
                    while (dateEnd.diff(dateStart, 'months') >= 0) {
                        months.push({
                            key: dateStart.format('M'),
                            value: dateStart.format('yyyy-MM-DD'),
                            label: dateStart.format('yyyy年M月')
                        });
                        dateStart.add(1, 'month')
                    }
                    return months;
                },
                getEvents() {
                    const events = [];
                    /*
                    events.push({
                        name: '産前休暇',
                        start: this.preStartDate.format('yyyy-MM-DD'),
                        end: this.preEndDate.format('yyyy-MM-DD'),
                        timed: false,
                        color: 'blue'
                    });
                    events.push({
                        name: '産後休暇',
                        start: this.postStartDate.format('yyyy-MM-DD'),
                        end: this.postEndDate.format('yyyy-MM-DD'),
                        timed: false,
                        color: 'green'
                    });
                    */
                    events.push({
                        name: '予定日',
                        start: this.expectedDate,
                        end: null,
                        timed: false,
                        color: '#f00'
                    });
                    if (!this.onSchedule) {
                        events.push({
                            name: '出産日',
                            start: this.birthDate,
                            end: null,
                            timed: false,
                            color: '#f90'
                        });
                    }
                    return events;
                },
                getEventColor(event) {
                    return event.color;
                },
                dayFormat(date) {
                    return new Date(date).getDate()
                },
                getDayColor(date) {
                    const d = moment(date);
                    if (d.isSameOrAfter(this.preStartDate) && d.isSameOrBefore(this.preEndDate)) {
                        return 'primary';
                    } else if (d.isSameOrAfter(this.postStartDate) && d.isSameOrBefore(this.postEndDate)) {
                        return 'success';
                    } else {
                        return 'white';
                    }
                }
            }
        })
    </script>
    <style>
        .v-outside .v-event,
        .v-outside .v-btn {
            display: none;
        }
    </style>
</body>

</html>